<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ArtistInfoMapper">
	<resultMap type="ArtistInfo" id="artistInfoMap">
		<result property="myProfile" column="MY_PROFILE"/>
		<result property="myReProfile" column="MY_REPROFILE"/>
		<result property="myInfo" column="MY_INFO"/>
		<result property="createDate" column="CREATE_DATE"/>
		<result property="modifyDate" column="MODIFY_DATE"/>
		<result property="workAddress" column="WORK_ADDRESS"/>
		<result property="artistId" column="ARTIST_ID"/>
	</resultMap>
	<resultMap type="ArtistFollow" id="followMap">
		<result property="customerProfile" column="CUSTOMER_PROFILE"/>
		<result property="customerId" column="CUSTOMER_ID"/>
		<result property="artistId" column="ARTIST_ID"/>
	</resultMap>
	
 	<select id="selectArtistFollow" resultMap="followMap">
		SELECT * 
		FROM FOLLOWING JOIN CUSTOMER USING(CUSTOMER_ID)
			LEFT OUTER JOIN ARTISTINFO USING(ARTIST_ID)
		WHERE CUSTOMER_ID = #{ customerId } AND ARTIST_ID = #{ artistId }
	</select>
	
	<!-- 팔로우 등록 -->
	<insert id="insertArtistFollow">
		INSERT INTO FOLLOWING
		VALUES( #{customerId}, #{artistId})
	</insert>
	
	
	<delete id="deleteArtistFollow">
		DELETE FROM FOLLOWING
		WHERE CUSTOMER_ID = #{ customerId } AND ARTIST_ID = #{ artistId }
	</delete>
	
	
	
	<!-- 아티스트 팔로우 리스트  -->
	<select id="selectListArtistFollow" resultMap="followMap">
		SELECT CUSTOMER_PROFILE, ARTIST_ID, CUSTOMER_ID
		FROM FOLLOWING JOIN CUSTOMER USING(CUSTOMER_ID)
				 LEFT OUTER JOIN ARTISTINFO USING(ARTIST_ID)
		WHERE ARTIST_ID = #{artistId}
	</select>
	
	
	<!-- 아티스트정보 입력 -->
	<insert id="insertArtistInfo">
		INSERT INTO ARTISTINFO
		VALUES(#{name}, #{myProfile}, #{myReProfile}, #{myInfo}, SYSDATE, SYSDATE, #{artistId})
	</insert>
	
	
	<!-- 아티스트 리스트  출력 -->
	<select id="selectListArtist" resultMap="artistInfoMap">
		SELECT *
		FROM ARTISTINFO
		LEFT JOIN
		(SELECT ARTIST_ID,COUNT(*)
		AS COUNT FROM FOLLOWING GROUP BY ARTIST_ID) USING(ARTIST_ID)
	</select>
	
	<!-- 아티스트 1명 조회  -->
	<select id="selectOneArtist" resultMap="artistInfoMap">
		SELECT * FROM ARTISTINFO 
		WHERE ARTIST_ID = #{artistId}
	</select>
	<!-- 아티스트 소개 업데이트 -->
	<update id="updateArtistInfo">
		UPDATE ARTISTINFO
		SET NAME=#{name}, MY_PROFILE=#{myProfile}, MY_REPROFILE=#{myReProfile}, MY_INFO=#{myInfo},
		CREATE_DATE = SYSDATE, MODIFY_DATE = SYSDATE
		WHERE ARTIST_ID = #{artistId}
	</update>
	
	
	
</mapper>
